<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>4. 印泥干裂</title></head>
<body style="background:#f5f5f5; padding:20px; font-family:sans-serif">
<h3>印泥干裂：油墨干涸产生细小裂纹</h3>
<canvas id="canvas" width="400" height="400" style="border:1px solid #ccc; background:white"></canvas>
<script src="./js/common.js"></script>
<script>

// 生成裂纹蒙版（程序生成，无需图片）
function generateCrackMask(width, height) {
  const canvas = document.createElement('canvas');
  canvas.width = width; canvas.height = height;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = 'white';
  ctx.fillRect(0,0,width,height);
  ctx.strokeStyle = 'black';
  ctx.lineWidth = 1;
  // 随机短线段模拟裂纹
  for(let i=0; i<200; i++) {
    const x1 = Math.random()*width;
    const y1 = Math.random()*height;
    const len = 5 + Math.random()*15;
    const angle = Math.random()*Math.PI*2;
    const x2 = x1 + Math.cos(angle)*len;
    const y2 = y1 + Math.sin(angle)*len;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  }
  return canvas;
}

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const cx = 200, cy = 200, r = 150;

drawFreshSeal(ctx, cx, cy, r);

// 叠加裂纹
const crack = generateCrackMask(canvas.width, canvas.height);
ctx.globalCompositeOperation = 'destination-in';
ctx.globalAlpha = 0.2;
ctx.drawImage(crack, 0, 0);
ctx.globalCompositeOperation = 'source-over';
ctx.globalAlpha = 1;
</script>
</body>
</html>