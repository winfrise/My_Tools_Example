<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å‹ç¼©ä¼ªå½±æ¨¡æ‹Ÿå™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .controls {
      margin: 20px 0;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input[type="range"] {
      width: 100%;
    }
    .preview {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .panel {
      flex: 1;
      min-width: 300px;
    }
    .panel img {
      width: 100%;
      height: auto;
      border: 1px solid #ccc;
      background: white;
    }
    .quality-value {
      font-weight: bold;
      color: #e74c3c;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <h1>ğŸ–¼ï¸ å‹ç¼©ä¼ªå½±æ•ˆæœæ¨¡æ‹Ÿå™¨</h1>

  <div class="controls">
    <label>é€‰æ‹©æœ¬åœ°å›¾ç‰‡ï¼š<input type="file" id="fileInput" accept="image/*"></label>

    <label>æˆ–è¾“å…¥ç½‘ç»œå›¾ç‰‡ URLï¼š
      <input type="url" id="urlInput" placeholder="https://example.com/image.jpg" style="width:100%; padding:6px; margin-top:5px;">
    </label>
    <button onclick="loadFromURL()">åŠ è½½ç½‘ç»œå›¾ç‰‡</button>

    <label>å‹ç¼©è´¨é‡ï¼š<span class="quality-value" id="qualityValue">80</span>%</label>
    <input type="range" id="qualitySlider" min="1" max="100" value="80" oninput="updateQuality(this.value)">

    <p>ğŸ’¡ æç¤ºï¼šå°†è´¨é‡è°ƒä½ï¼ˆå¦‚ 20ï½50ï¼‰å¯æ˜æ˜¾çœ‹åˆ°æ–‡å­—è¾¹ç¼˜å‡ºç°å½©è‰²å™ªç‚¹ï¼ˆé»„/ç´«/ç»¿ç­‰ï¼‰</p>
  </div>

  <div class="preview">
    <div class="panel">
      <h3>åŸå§‹å›¾åƒ</h3>
      <img id="originalImg" src="" alt="åŸå§‹å›¾" />
    </div>
    <div class="panel">
      <h3>å‹ç¼©åï¼ˆJPEG æ¨¡æ‹Ÿï¼‰</h3>
      <img id="compressedImg" src="" alt="å‹ç¼©å›¾" />
    </div>
  </div>

  <script>
    let originalImage = null;

    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          loadImage(event.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    function loadFromURL() {
      const url = document.getElementById('urlInput').value.trim();
      if (url) {
        // ç»•è¿‡ CORS çš„ç®€å•å°è¯•ï¼ˆä¸ä¸€å®šæˆåŠŸï¼‰
        loadImage(url);
      } else {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å›¾ç‰‡ URL');
      }
    }

    function loadImage(src) {
      const img = new Image();
      // å°è¯•è§£å†³è·¨åŸŸé—®é¢˜ï¼ˆä»…å¯¹æ”¯æŒ CORS çš„å›¾æœ‰æ•ˆï¼‰
      img.crossOrigin = "anonymous";
      img.onload = function() {
        originalImage = img;
        document.getElementById('originalImg').src = src;
        compressImage();
      };
      img.onerror = function() {
        alert('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ URL æˆ– CORS ç­–ç•¥');
      };
      img.src = src;
    }

    function updateQuality(value) {
      document.getElementById('qualityValue').textContent = value;
      if (originalImage) compressImage();
    }

    function compressImage() {
      if (!originalImage) return;

      const quality = parseInt(document.getElementById('qualitySlider').value) / 100;
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      // è®¾ç½® canvas å°ºå¯¸
      canvas.width = originalImage.naturalWidth || originalImage.width;
      canvas.height = originalImage.naturalHeight || originalImage.height;

      // ç»˜åˆ¶åŸå›¾
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(originalImage, 0, 0);

      // å¯¼å‡ºä¸ºä½è´¨é‡ JPEGï¼ˆè§¦å‘å‹ç¼©ä¼ªå½±ï¼‰
      const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);

      // æ˜¾ç¤ºå‹ç¼©ç»“æœ
      document.getElementById('compressedImg').src = compressedDataUrl;
    }
  </script>
</body>
</html>