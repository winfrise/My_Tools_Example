<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é«˜çº§è§†é¢‘æ’­æ”¾å™¨ - ç²¾ç®€ç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }

    .player-wrapper {
      max-width: 960px;
      margin: 0 auto;
    }

    /* å…¨å±ç›®æ ‡å®¹å™¨ */
    .player-fullscreen-target {
      position: relative;
      border: 1px solid #ccc;
      background: #000;
      --controls-height: 70px;
    }

    .video-container {
      position: relative;
      width: 100%;
      height: 500px;
      overflow: hidden;
      background: #000;
      cursor: move;
    }

    #video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transform-origin: center center;
      transition: none;
    }

    /* è‡ªå®šä¹‰æ§åˆ¶æ¡ */
    .custom-controls {
      position: relative;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 8px 12px;
      pointer-events: none;
    }

    .custom-controls > * {
      pointer-events: auto;
    }

    .progress-row {
      width: 100%;
      height: 6px;
      background: #444;
      border-radius: 3px;
      cursor: pointer;
      position: relative;
      margin-bottom: 8px;
    }

    .progress-bar {
      height: 100%;
      background: #1e90ff;
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s;
    }

    .controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .playback-controls {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .control-btn {
      background: none;
      border: 1px solid #666;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      min-width: 36px;
      text-align: center;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: #999;
    }

    .status-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .time-display {
      font-size: 13px;
      white-space: nowrap;
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .volume-slider {
      width: 60px;
      height: 4px;
      background: #444;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }

    .volume-level {
      height: 100%;
      background: white;
      border-radius: 2px;
      width: 80%;
    }

    select.speed-select {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid #666;
      border-radius: 3px;
      padding: 2px 6px;
      font-size: 12px;
      cursor: pointer;
    }

    /* å…¨å±æ ·å¼ */
    .player-fullscreen-target.fullscreen {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 2000;
      background: #000;
    }

    .player-fullscreen-target.fullscreen .video-container {
      height: calc(100vh - var(--controls-height)) !important;
    }

    .player-fullscreen-target.fullscreen #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* é¡¶éƒ¨åŠ è½½åŒº */
    .top-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      align-items: center;
    }

    button {
      padding: 6px 12px;
      cursor: pointer;
    }

    input[type="text"] {
      flex: 1;
      padding: 6px;
    }

    .hint {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="player-wrapper">
    <h2>é«˜çº§è§†é¢‘æ’­æ”¾å™¨ - ç²¾ç®€ç‰ˆ</h2>

    <!-- å…¨å±ç›®æ ‡å®¹å™¨ -->
    <div class="player-fullscreen-target" id="fullscreenTarget">
      <div class="video-container" id="container">
        <video id="video"></video>
      </div>

      <!-- è‡ªå®šä¹‰æ§åˆ¶æ¡ -->
      <div class="custom-controls">
        <div class="progress-row" id="progressContainer">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="controls-row">
          <div class="playback-controls">
            <button class="control-btn" id="toStart">Â«Â«</button>
            <button class="control-btn" id="rewind">Â«</button>
            <button class="control-btn" id="playPause">â–¶</button>
            <button class="control-btn" id="forward">Â»</button>
            <button class="control-btn" id="toEnd">Â»Â»</button>
          </div>
          <div class="status-group">
            <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
            <div class="volume-control">
              <span>ğŸ”ˆ</span>
              <div class="volume-slider" id="volumeSlider">
                <div class="volume-level" id="volumeLevel"></div>
              </div>
            </div>
            <select class="speed-select" id="speedSelect">
              <option value="0.5">0.5x</option>
              <option value="0.75">0.75x</option>
              <option value="1" selected>1x</option>
              <option value="1.25">1.25x</option>
              <option value="1.5">1.5x</option>
              <option value="2">2x</option>
            </select>
            <button class="control-btn" id="fullscreenBtn">å…¨å±</button>
          </div>
        </div>
      </div>
    </div>

    <!-- é¡¶éƒ¨æ§åˆ¶ -->
    <div class="top-controls">
      <input type="text" id="urlInput" placeholder="è¾“å…¥è§†é¢‘åœ°å€ï¼ˆæ”¯æŒ .m3u8 æˆ– .mp4ï¼‰"
             value="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" />
      <button id="loadBtn">åŠ è½½è§†é¢‘</button>
      <button id="zoomIn">+</button>
      <button id="zoomOut">âˆ’</button>
      <span id="zoomLevel">100%</span>
      <button id="resetView">é‡ç½®è§†å›¾</button>
    </div>
    <p class="hint">
      æ“ä½œæç¤ºï¼š<br>
      â€¢ æ»šè½®ï¼šç¼©æ”¾ï½œç›´æ¥æ‹–åŠ¨ï¼šå¹³ç§»
    </p>
  </div>

  <script>
    // ========== DOM ==========
    const video = document.getElementById('video');
    const container = document.getElementById('container');
    const fullscreenTarget = document.getElementById('fullscreenTarget');
    const urlInput = document.getElementById('urlInput');
    const loadBtn = document.getElementById('loadBtn');
    const zoomInBtn = document.getElementById('zoomIn');
    const zoomOutBtn = document.getElementById('zoomOut');
    const resetBtn = document.getElementById('resetView');
    const zoomLevelEl = document.getElementById('zoomLevel');

    // æ§åˆ¶æ¡
    const playPauseBtn = document.getElementById('playPause');
    const toStartBtn = document.getElementById('toStart');
    const rewindBtn = document.getElementById('rewind');
    const forwardBtn = document.getElementById('forward');
    const toEndBtn = document.getElementById('toEnd');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const timeDisplay = document.getElementById('timeDisplay');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeLevel = document.getElementById('volumeLevel');
    const speedSelect = document.getElementById('speedSelect');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    // ========== çŠ¶æ€ ==========
    let scale = 1;
    let translateX = 0;
    let translateY = 0;
    const minScale = 0.1;
    const maxScale = 10;

    let isPanning = false;
    let startPanX = 0, startPanY = 0;

    // ========== å·¥å…·å‡½æ•° ==========
    function formatTime(seconds) {
      if (isNaN(seconds)) return '00:00';
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateTransform() {
      video.style.transform = `scale(${scale}) translate(${translateX}px, ${translateY}px)`;
      zoomLevelEl.textContent = `${Math.round(scale * 100)}%`;
    }

    function resetView() {
      scale = 1;
      translateX = 0;
      translateY = 0;
      updateTransform();
    }

    function loadVideo(src) {
      resetView();
      if (Hls.isSupported() && src.endsWith('.m3u8')) {
        if (video.hls) video.hls.destroy();
        const hls = new Hls();
        video.hls = hls;
        hls.loadSource(src);
        hls.attachMedia(video);
      } else if (video.canPlayType('application/vnd.apple.mpegurl') && src.endsWith('.m3u8')) {
        video.src = src;
      } else {
        video.src = src;
      }
    }

    // ========== ç¼©æ”¾ ==========
    zoomInBtn.addEventListener('click', () => {
      scale = Math.min(maxScale, scale + 0.2);
      updateTransform();
    });

    zoomOutBtn.addEventListener('click', () => {
      scale = Math.max(minScale, scale - 0.2);
      updateTransform();
    });

    resetBtn.addEventListener('click', resetView);

    container.addEventListener('wheel', (e) => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? -0.1 : 0.1;
      scale = Math.min(maxScale, Math.max(minScale, scale + delta));
      updateTransform();
    }, { passive: false });

    // ========== æ§åˆ¶æ¡é€»è¾‘ ==========
    video.addEventListener('loadedmetadata', () => {
      timeDisplay.textContent = `00:00 / ${formatTime(video.duration)}`;
    });

    video.addEventListener('timeupdate', () => {
      const percent = (video.currentTime / (video.duration || 1)) * 100;
      progressBar.style.width = `${percent}%`;
      timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
    });

    playPauseBtn.addEventListener('click', () => {
      if (video.paused) {
        video.play();
        playPauseBtn.textContent = 'â¸';
      } else {
        video.pause();
        playPauseBtn.textContent = 'â–¶';
      }
    });

    video.addEventListener('play', () => playPauseBtn.textContent = 'â¸');
    video.addEventListener('pause', () => playPauseBtn.textContent = 'â–¶');

    progressContainer.addEventListener('click', (e) => {
      const rect = progressContainer.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const ratio = Math.max(0, Math.min(1, clickX / rect.width));
      video.currentTime = ratio * (video.duration || 0);
    });

    rewindBtn.addEventListener('click', () => {
      video.currentTime = Math.max(0, video.currentTime - 10);
    });

    forwardBtn.addEventListener('click', () => {
      video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 10);
    });

    toStartBtn.addEventListener('click', () => {
      video.currentTime = 0;
    });

    toEndBtn.addEventListener('click', () => {
      if (video.duration) video.currentTime = video.duration;
    });

    // éŸ³é‡
    video.volume = 0.8;
    volumeLevel.style.width = '80%';

    volumeSlider.addEventListener('click', (e) => {
      const rect = volumeSlider.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      let vol = Math.max(0, Math.min(1, clickX / rect.width));
      video.volume = vol;
      volumeLevel.style.width = `${vol * 100}%`;
    });

    // æ’­æ”¾é€Ÿåº¦
    speedSelect.addEventListener('change', () => {
      video.playbackRate = parseFloat(speedSelect.value);
    });

    // å…¨å±é€»è¾‘
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        if (fullscreenTarget.requestFullscreen) {
          fullscreenTarget.requestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    fullscreenBtn.addEventListener('click', toggleFullscreen);

    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement === fullscreenTarget) {
        fullscreenBtn.textContent = 'é€€å‡ºå…¨å±';
        fullscreenTarget.classList.add('fullscreen');
      } else {
        fullscreenBtn.textContent = 'å…¨å±';
        fullscreenTarget.classList.remove('fullscreen');
      }
    });

    // ========== é¼ æ ‡äº¤äº’ï¼ˆä»…å¹³ç§»ï¼‰ ==========
    container.addEventListener('mousedown', (e) => {
      isPanning = true;
      startPanX = e.clientX - translateX;
      startPanY = e.clientY - translateY;
      container.style.cursor = 'grabbing';
      e.preventDefault();
    });

    window.addEventListener('mousemove', (e) => {
      if (isPanning) {
        translateX = e.clientX - startPanX;
        translateY = e.clientY - startPanY;
        updateTransform();
      }
    });

    window.addEventListener('mouseup', () => {
      if (isPanning) {
        isPanning = false;
        container.style.cursor = 'move';
      }
    });

    // ========== åˆå§‹åŒ– ==========
    loadBtn.addEventListener('click', () => {
      loadVideo(urlInput.value.trim());
    });

    window.addEventListener('load', () => {
      loadVideo(urlInput.value.trim());
    });
  </script>
</body>
</html>